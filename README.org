#+TITLE: Dotfiles

Hi. Welcome to my dotfiles.

* i3

** Constants

#+MACRO: mod Mod4
#+MACRO: lockscreen i3-lock-fancy
#+MACRO: xrandrLayouts ~/.dotfiles/xrandr/layouts/
#+MACRO: wallpapers ~/Pictures/Wallpapers
#+MACRO: touchpad 'DELL0829:00 06CB:7E92 Touchpad'
#+MACRO: scriptsDir ~/.dotfiles/scripts

- Mod key: {{{mod}}}
- Locksceren command: {{{lockscreen}}}
- Directory with XRandr layouts: {{{xrandrLayouts}}}
- Wallpaper directory: {{{wallpapers}}}
- Touchpad name (for xinput): {{{touchpad}}}
- Scripts directory: {{{scriptsDir}}}

** Config

#+NAME: config-table
| Configuration     | Value                    | Description                                  |
|-------------------+--------------------------+----------------------------------------------|
| font              | pango:DejaVu Sans Mono 8 | Sets font                                    |
| floating_modifier | {{{mod}}}                | Use Mouse+{{{mod}}} to drag floating windows |
| new_window        | 1pixel                   |                                              |
| gaps              | inner 10                 | Sets gap size (i3-gaps only)                 |

#+NAME: config-table-generator
#+BEGIN_SRC emacs-lisp :var table=config-table :results output :exports results
(dolist (row table)
  (princ (format "%s %s\n" (nth 0 row) (nth 1 row))))
#+END_SRC

** Keybinds

*** Navigation and i3 stuff
#+NAME: navigation-table
| Keybind               | Command                                      | Is Exec | Action                                           |
|-----------------------+----------------------------------------------+---------+--------------------------------------------------|
| {{{mod}}}+Return      | i3-sensible-terminal                         | t       | Opens a new terminal                             |
| {{{mod}}}+Shift+q     | kill                                         | nil     | Kills the focused window                         |
| {{{mod}}}+d           | rofi -combi-modi window,drun,ssh -show combi | t       | Runs rofi in combined mode                       |
| {{{mod}}}+h           | focus left                                   | nil     |                                                  |
| {{{mod}}}+j           | focus down                                   | nil     |                                                  |
| {{{mod}}}+k           | focus up                                     | nil     |                                                  |
| {{{mod}}}+l           | focus right                                  | nil     |                                                  |
| {{{mod}}}+Shift+h     | move left                                    | nil     |                                                  |
| {{{mod}}}+Shift+j     | move down                                    | nil     |                                                  |
| {{{mod}}}+Shift+k     | move up                                      | nil     |                                                  |
| {{{mod}}}+Shift+l     | move right                                   | nil     |                                                  |
| {{{mod}}}+b           | split h                                      | nil     | Splits horizontally                              |
| {{{mod}}}+v           | split v                                      | nil     | Splits vertically                                |
| {{{mod}}}+f           | fullscreen toggle                            | nil     | Toggles fullscreen mode for the focused window   |
| {{{mod}}}+s           | layout stacking                              | nil     | Sets layout to stacking                          |
| {{{mod}}}+w           | layout tabbed                                | nil     | Sets layout to tabbed                            |
| {{{mod}}}+e           | layout toggle split                          | nil     | Toggles layout to split                          |
| {{{mod}}}+Shift+space | floating toggle                              | nil     | Toggles floating for the current window          |
| {{{mod}}}+space       | focus mode_toggle                            | nil     | Change focus between tiling and floating windows |
| {{{mod}}}+a           | focus parent                                 | nil     | Focuses the parent window                        |
| {{{mod}}}+Shift+c     | reload                                       | nil     | Reloads the configuration file                   |
| {{{mod}}}+Shift+r     | restart                                      | nil     | Restarts i3 in place                             |
| {{{mod}}}+r           | mode "resize"                                | nil     | Toggles resize mode                              |

#+NAME: navigation-table-generator
#+BEGIN_SRC emacs-lisp :var table=navigation-table :results output :exports results
(dolist (row table)
  (princ (format "bindsym %s%s %s\n"
                 (nth 0 row)
                 (if (string= "t" (nth 2 row))
                     " exec --no-startup-id"
                     "")
                 (if (string= "t" (nth 2 row)) (format "\"%s\"" (nth 1 row)) (nth 1 row)))))
#+END_SRC

*** Workspaces
#+NAME: workspaces-table
| Keybind    | Command   | Action                |
|------------+-----------+-----------------------|
| {{{mod}}}+ | workspace | Switches to workspace |

#+NAME: workspaces-table-generator
#+BEGIN_SRC emacs-lisp :var table=workspaces-table :results output :exports results
(let ((num 0))
  (while (< num 10)
    (setq num (+ num 1))
    (princ (format "bindsym %s%d %s %d\n" (nth 0 (nth 0 table)) num (nth 1 (nth 0 table)) num))))
#+END_SRC

*** Shortcuts
#+NAME: shortcuts-table
| Keybind              | Command                               | Action                       |
|----------------------+---------------------------------------+------------------------------|
| Print                | flameshot gui                         | Starts flameshot in gui mode |
| XF86AudioMute        | amixer -q -D pulse sset Master toggle | Toggles mute                 |
| XF86AudioLowerVolume | pactl set-sink-volume 0 -5%           | Lowers volume by 5%          |
| XF86AudioRaiseVolume | pactl set-sink-volume 0 +5%           | Raises volume by 5%          |
| XF86AudioPlay        | mpc toggle                            | Plays / pauses on mpc        |
| XF86AudioNext        | mpc next                              | Next track on mpc            |
| XF86AudioPrev        | mpc prev                              | Previous track on mpc        |
| {{{mod}}}+x          | ~/.emacs.d/bin/org-capture            | Org-capture                  |
| {{{mod}}}+p          | {{{lockscreen}}}                      | Starts the lockscreen        |

#+NAME: shortcuts-table-generator
#+BEGIN_SRC emacs-lisp :var table=shortcuts-table :results output :exports results
(dolist (row table)
  (princ (format "bindsym %s exec --no-startup-id %s\n" (nth 0 row) (nth 1 row))))
#+END_SRC

** Autostart Commands

#+NAME: autostart-table
| Command                                                     | Runs Always | Startup ID | Description                 |
|-------------------------------------------------------------+-------------+------------+-----------------------------|
| xinput set-prop {{{touchpad}}} 'libinput Tapping Enabled' 1 | nil         | nil        | Enables tapping             |
| setxkbmap -option caps:swapescape                           | nil         | nil        | Swaps caps lock with escape |
| compton --config ~/.config/i3/compton.conf -b               | nil         | nil        | Starts compton              |
| dunst                                                       | nil         | nil        | Notification manager        |
| xset +fp ~/.fonts                                           | nil         | nil        | Loads fonts                 |
| xset fp rehash                                              | nil         | nil        |                             |
| feh --bg-max --randomize {{{wallpapers}}}* &                | t           | nil        | Loads a random wallpaper    |
| ~/.dotfiles/xrandr/apply.sh {{{xrandrLayouts}}}             | t           | t          | Loads xrandr layouts        |
| flameshot                                                   | nil         | nil        | Screenshot tool             |
| nm-applet                                                   | nil         | nil        | Network Manager applet      |
| tint2                                                       | nil         | nil        | Application bar             |

#+NAME: autostart-table-generator
#+BEGIN_SRC emacs-lisp :var table=autostart-table :results output :exports results
(dolist (row table)
  (princ (format "exec%s%s %s\n"
                 (if (string= "t" (nth 1 row)) "_always" "")
                 (if (string= "nil" (nth 2 row)) " --no-startup-id" "")
                 (nth 0 row)
                 )))
#+END_SRC
** Extra

This is stuff that doesn't translate very well into literate programming :(

#+NAME: extra
#+BEGIN_SRC text
#Resize mode
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window’s width.
        # Pressing right will grow the window’s width.
        # Pressing up will shrink the window’s height.
        # Pressing down will grow the window’s height.
        bindsym h resize shrink width 10 px or 10 ppt
        bindsym j resize grow height 10 px or 10 ppt
        bindsym k resize shrink height 10 px or 10 ppt
        bindsym l resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape or $mod+r
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}
#+END_SRC

** Output

#+BEGIN_SRC text :noweb yes :tangle config/i3/config
# Config
<<config-table-generator()>>

# Keybinds
## Navigation
<<navigation-table-generator()>>

## Workspaces
<<workspaces-table-generator()>>

## Shortcuts
<<shortcuts-table-generator()>>

# Autostart
<<autostart-table-generator()>>

# Extra
<<extra>>
#+END_SRC

* Utility

** Hook to resolve macros when tangling
#+BEGIN_SRC emacs-lisp :results none
(add-hook 'org-babel-pre-tangle-hook
          (lambda () (org-macro-replace-all (org-macro--collect-macros))))
#+END_SRC

** Interactive function to tangle without changing the source file
#+BEGIN_SRC emacs-lisp :results none
(defun org-tangle-without-saving ()
  (interactive)
  (cl-letf (((symbol-function 'save-buffer) #'ignore))
    (org-babel-tangle)
  )
  (undo-tree-undo))
#+END_SRC
